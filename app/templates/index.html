<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{{ url_for('static', filename='images/bar-chart-dollar.svg') }}" type="x-icon">
    <title>Trading Journal</title>
    <link href="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.7.0/dist/css/tempus-dominus.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.lineicons.com/5.0/lineicons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="wrapper">
        <special-sidenav></special-sidenav>
        <div class="main">
            <nav class="navbar navbar-expand px-4 py-3">
                <h3 class="fw-bold fs-4 mb-3">Trading Journal</h3>
                <div class="navbar-collapse collapse">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item dropdown">
                            <a href="#" class="nav-icon pe-md-0" data-bs-toggle="dropdown">
                                <img src="{{ url_for('static', filename='images/itoy.png') }}" class="avatar img-fluid" alt="">
                            </a>
                            <div class="dropdown-menu dropdown-menu-end rounded">
                                <a href="#" class="dropdown-item">
                                    logo
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
            <main class="content px-3 py-4">
                <div class="container-fluid">
                    <div class="mb-3">
                        <!-- Button should be inserted here -->
                         <button class="button rounded-5 mb-4" data-bs-toggle="modal" data-bs-target="#exampleModal">
                            <i class="lni lni-plus plus"></i>
                            <span class="me-2">Journal</span>
                         </button>
                         <!-- Button trigger modal -->
                          <!-- for modal -->
                        <!-- <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
                            Launch demo modal
                        </button> -->
                        
                        <!-- Modal -->
                        <!-- <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">Enter Trade Informations</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                    <form>
                                        <div class="modal-body">
                                          <div class="mb-3">
                                            <label for="datepicker" class="form-label">Select a Date</label>
                                            <div class="input-group">
                                              <input type="text" class="form-control" id="datepicker" placeholder="MM/DD/YYYY">
                                              <span class="input-group-text">
                                                <i class="bi bi-calendar-event"></i>
                                              </span>
                                            </div>
                                          </div>
                                          <div class="mb-3">
                                            <select id="tradeDay" class="form-select">
                                              <option value="" selected>Select Trade Day</option>
                                              <option value="Tuesday">Tuesday</option>
                                              <option value="Wednesday">Wednesday</option>
                                              <option value="Thursday">Thursday</option>
                                              <option value="Friday">Friday</option>
                                            </select>
                                          </div>
                                          <div class="mb-3">
                                            <select id="tradePair" class="form-select">
                                              <option value="" selected>Select Pair</option>
                                              <option value="NQ">NQ</option>
                                              <option value="ES">ES</option>
                                              <option value="DAX">DAX</option>
                                              <option value="XAU/USD">XAU/USD</option>
                                            </select>
                                          </div>
                                          <div class="mb-3">
                                            <select id="tradeBias" class="form-select">
                                              <option value="" selected>Select BIAS</option>
                                              <option value="Bullish">Bullish</option>
                                              <option value="Bearish">Bearish</option>
                                            </select>
                                          </div>
                                          <div class="mb-3">
                                            <select id="tradePosition" class="form-select">
                                              <option value="" selected>Select Trade Position</option>
                                              <option value="Long">Long</option>
                                              <option value="Short">Short</option>
                                            </select>
                                          </div>
                                          <div class="mb-3">
                                            <input type="number" class="form-control" id="slPips" placeholder="SL Pips">
                                          </div>
                                          <div class="mb-3">
                                            <input type="number" class="form-control" id="riskPercent" placeholder="Risk Percentage (%)">
                                          </div>
                                          <div class="mb-3">
                                            <input type="number" class="form-control" id="pnl" placeholder="PnL">
                                          </div>
                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                          <button type="button" class="btn btn-primary trade-button">Add to Journal</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div> -->
                        <!-- for modal -->

                        <!-- text -->
                        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="exampleModalLabel">Add Trade</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <form id="tradeForm" action="/add" method="POST">
                                  <div class="modal-body">
                                    <!-- <div class="mb-3">
                                      <label for="tradeDate" class="form-label">Select a Date</label>
                                      <input type="text" class="form-control" id="tradeDate" placeholder="MM/DD/YYYY">
                                    </div> -->
                                    <div class="mb-3">
                                        <label for="datepicker" class="form-label">Select a Date</label>
                                        <div class="input-group">
                                          <input type="text" class="form-control" id="datepicker" autocomplete="off" placeholder="MM/DD/YYYY" name="datePicker">
                                          <span class="input-group-text">
                                            <i class="bi bi-calendar-event"></i>
                                          </span>
                                        </div>
                                      </div>
                                    <div class="mb-3">
                                      <label for="tradeDay" class="form-label">Trade Day</label>
                                      <select id="tradeDay" class="form-select" name="tradeDay">
                                        <option value="" selected>Select Trade Day</option>
                                        <option value="Tuesday">Tuesday</option>
                                        <option value="Wednesday">Wednesday</option>
                                        <option value="Thursday">Thursday</option>
                                        <option value="Friday">Friday</option>
                                      </select>
                                    </div>
                                    <div class="mb-3">
                                      <label for="tradePair" class="form-label">Pair</label>
                                      <select id="tradePair" class="form-select" name="tradePair">
                                        <option value="" selected>Select Pair</option>
                                        <option value="NQ">NQ</option>
                                        <option value="ES">ES</option>
                                        <option value="DAX">DAX</option>
                                        <option value="XAU/USD">XAU/USD</option>
                                      </select>
                                    </div>
                                    <div class="mb-3">
                                      <label for="tradeBias" class="form-label">Bias</label>
                                      <select id="tradeBias" class="form-select" name="tradeBias">
                                        <option value="" selected>Select BIAS</option>
                                        <option value="Bullish">Bullish</option>
                                        <option value="Bearish">Bearish</option>
                                      </select>
                                    </div>
                                    <div class="mb-3">
                                      <label for="tradePosition" class="form-label">Trade Position</label>
                                      <select id="tradePosition" class="form-select" name="tradePosition">
                                        <option value="" selected>Select Position</option>
                                        <option value="Long">Long</option>
                                        <option value="Short">Short</option>
                                      </select>
                                    </div>
                                    <div class="mb-3">
                                      <input type="number" class="form-control" id="slPips" placeholder="SL Pips" name="slPips">
                                    </div>
                                    <div class="mb-3">
                                      <input type="number" class="form-control" step="any" id="riskPercent" placeholder="Risk Percentage (%)" name="riskPercent">
                                    </div>
                                    <div class="mb-3">
                                      <input type="number" class="form-control" id="pnl" placeholder="PnL" name="pnl">
                                    </div>
                                  </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary" id="addTrade" data-bs-dismiss="modal">Add to Journal</button>
                                  </div>
                                </form>
                              </div>
                            </div>
                          </div>
                        <!-- test -->

                        <!-- <h3 class="fw-bold fs-4 mb-3">Trading Journal</h3> -->
                        <div class="row">
                            <div class="col-12 col-md-4">
                                <div class="card card-hover border-0">
                                    <div class="card-body py-4">
                                        <h5 class="mb-2 fw-bold">
                                          Balance
                                        </h5>
                                        <p class="mb-2 fw-bold">
                                          ${{ total_pnl }}
                                        </p>
                                        <div class="mb-0">
                                            <span class="badge text-success me-2">
                                                +0.9%
                                            </span>
                                            <span class="fw-bold">
                                                Since Last Month
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-4">
                                <div class="card card-hover border-0">
                                    <div class="card-body py-4">
                                        <h5 class="mb-2 fw-bold">
                                          No. of Trades
                                        </h5>
                                        <p class="mb-2 fw-bold">
                                          {{ total_count }}
                                        </p>
                                        <div class="mb-0">
                                            <span class="badge text-success me-2">
                                                +0.9%
                                            </span>
                                            <span class="fw-bold">
                                                Since Last Month
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-4">
                                <div class="card card-hover border-0">
                                    <div class="card-body py-4">
                                        <h5 class="mb-2 fw-bold">
                                            Win Rate
                                        </h5>
                                        <p class="mb-2 fw-bold">
                                          {{ win_rate }}
                                        </p>
                                        <div class="mb-0">
                                            <span class="badge text-success me-2">
                                                +0.9%
                                            </span>
                                            <span class="fw-bold">
                                                Since Last Month
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <h3 class="fw-bold fs-4 my-3">Trades</h3>
                            <!-- Trade -->
                            <div class="container mt-3 table-responsive tables">
                                <table class="table table-striped">
                                  <thead>
                                    <tr>
                                      <th>Date</th>
                                      <th>Day</th>
                                      <th>Pair</th>
                                      <th>Bias</th>
                                      <th>Position</th>
                                      <th>SL Pips</th>
                                      <th>Risk %</th>
                                      <th>PnL</th>
                                      <th>Result</th>
                                    </tr>
                                  </thead>
                                  <tbody id="journalTableBody">
                                    <!-- New trades will be appended here -->
                                    {% for row in rows %}
                                      <tr>
                                          <td>{{ row.date }}</td>
                                          <td>{{ row.trade_day }}</td>
                                          <td>{{ row.pair }}</td>
                                          <td>{{ row.bias }}</td>
                                          <td>{{ row.position }}</td>
                                          <td>{{ row.sl_pips }}</td>
                                          <td>{{ row.risk_percentage }}</td>
                                          <td>{{ row.pnl }}</td>
                                          <td>{{ row.result }}</td>
                                      </tr>
                                    {% endfor %}
                                  </tbody>
                                </table>
                              </div>
                            <!-- trade -->
                            <!-- <div class="row">
                                <div class="col-12">
                                    <table class="table table-striped tableentry">
                                        <thead>
                                          <tr class="highlight">
                                            <th scope="col">Date</th>
                                            <th scope="col">Day</th>
                                            <th scope="col">Pair</th>
                                            <th scope="col">Bias</th>
                                            <th scope="col">Position</th>
                                            <th scope="col">SL Pips</th>
                                            <th scope="col">+R(%)</th>
                                            <th scope="col">PnL</th>
                                            <th scope="col">Result</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          <tr>
                                            <th scope="row">10/22/2024</th>
                                            <td>Wednesday</td>
                                            <td>XAU/USD</td>
                                            <td>Bullish</td>
                                            <td>Long</td>
                                            <td>120</td>
                                            <td>2RR</td>
                                            <td>$15</td>
                                            <td>Win</td>
                                          </tr>
                                          <tr>
                                            <th scope="row">10/22/2024</th>
                                            <td>Friday</td>
                                            <td>NQ</td>
                                            <td>Bearish</td>
                                            <td>Short</td>
                                            <td>50</td>
                                            <td>2RR</td>
                                            <td>$15</td>
                                            <td>BE</td>
                                          </tr>
                                          <tr>
                                            <th scope="row">10/22/2024</th>
                                            <td>Wednesday</td>
                                            <td>XAU/USD</td>
                                            <td>Bullish</td>
                                            <td>Long</td>
                                            <td>120</td>
                                            <td>2RR</td>
                                            <td>$15</td>
                                            <td>Win</td>
                                          </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div> -->
                        </div>
                    </div>
                </div>
            </main>
            <special-footer></special-footer>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="/static/js/navheaderfooterManager.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Datepicker JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.7.0/dist/js/tempus-dominus.min.js"></script>
    <script src="/static/js/main.js"></script>
    <script>
        $(document).ready(function () {
            $('#datepicker').datepicker({
                format: 'mm/dd/yyyy',
                autoclose: true,
                todayHighlight: true
            });
        });
        const journalUrl = "{{ journal_url }}";
        const analyticsUrl = "{{ analytics_url }}";

        function submitForm(event) {
          event.preventDefault();
          const form = event.target;
          const formData = new FormData(form);
          fetch('/add', {
              method: 'POST',
              body: formData
          })
          .then(response => response.json())
          .then(data => {
              // Handle the response
              if (data.success) {
                  window.location.href = '/';
              }
          });
        }
    </script>
</body>
</html>